
{% extends "generic.html" %} 
{% load static %}

{% block extra_head %}
<link href="{% static 'css/home/home_styles.css' %}" rel="stylesheet">

{% endblock %}

{% block body %}   
<section class="container-fluid d-flex flex-wrap my-5">

<section id="top_section " class="container-fluid d-flex justify-content-end flex-wrap ">
  <section class="col-5 container-fluid  d-flex flex-wrap mx-5">
    <div class="col-6">
      <a href="#">
      <button id="work-button" class="big-button" data-toggle="modal" data-target="#confirmationModal">trabajo</button>
      </a>
    </div>
    <div class="col-6">
      <a href="#">
        <button id="break-button" class="big-button" data-toggle="modal" data-target="#confirmationModal">descanso</button>
      </a>
    </div>
  </section>
  <!--MANDADOR DE TICKETS-->
  <section class="col-6 container-fluid d-flex flex-wrap justify-content-center font-white mx-0 px-0 ml-3">
    <div class="border text-center p-3  background-blue" style="width: 100%;">
        <h3>INFORMAR</h3>
        <hr>
        <form action="{% url 'send_notification' %}" method="post">
            {% csrf_token %} {{ form }}
            <hr>
            <input class="btn btn-info" type="submit" value="Enviar al administrador">
        </form>
    </div>
</section>
</section>
<section class="container-fluid d-flex flex-wrap justify-content-center text-center font-white mt-4 ">
  <div class="container-fluid background-blue  border">
    <div class="container-fluid row mx-1  py-2">
        <h4 class="col-4">Tipo</h4>
        <h4 class="col-4">Fecha</h4>
        <h4 class="col-4">Hora</h4>
        
    </div>
    <hr>
    <div id="register_container">
      {% for i in '0123456789123131312313' %}
      <div  class="container-fluid background-grey font-black row m-1  py-1">
        <h5 class="col-4">Descanso</h5>
        <h5 class="col-4">05/05/2021</h5>
        <h5 class="col-4">19:56</h5>
      </div>
      {% endfor %}

    </section>
    <section class="container-fluid d-flex flex-wrap justify-content-center text-center font-white mt-4 ">
        <div class="container-fluid background-blue border">
            <div class="container-fluid row mx-1  py-2">
                <h4 class="col-3">Tipo</h4>
                <h4 class="col-3">Fecha</h4>
                <h4 class="col-3">Hora</h4>
                <h4 class="col-3">filtrar por</h4>

            </div>
            <hr>
            <div id="register_container">
                {% for i in '0123456789123131312313' %}
                <div class="container-fluid background-grey font-black row m-1  py-1">
                    <h5 class="col-3">Descanso</h5>
                    <h5 class="col-3">05/05/2021</h5>
                    <h5 class="col-3">19:56</h5>
                    <h5 class="col-3"></h5>
                </div>
                {% endfor %}

            </div>
            <br>

            <!--{% for employee in employees %} 
    <div class="container-fluid row">
        <h3 class="col-3">{{ employee.dni }}</h3>
        <h3 class="col-8">{{ employee.name }} {{ employee.surname }}</h3>
        <div class="container-fluid col-1">
            <button class="btn col-3" data-toggle="modal" data-target="#createUserModal" data-whatever="Editar Usuario">R</button>
            <button class="btn col-3">V</button>
            <button class="btn col-3">D</button>
        </div>
    </div>
     {% endfor %}-->
        </div>



    </section>

    <!--
  <div class=" col-sm-12 col-md-6 relative text-end m-4">
    <a href="#">
        <img class="blur borderR-20px" src="{% static 'media/images/enter_work_background.png' %}" alt="enter_work_background">
        <div class="image_text ">
           <h5 class="pr-3 pl-3 mb-2 mx-5">ENTRAR TRABAJO</h5>
  
        </div>
    </a>
  </div>


    <div class=" col-sm-12 col-md-6 relative text-end m-4">
    <a href="#">
        <img class="blur borderR-20px" src="" alt="">
        <div class="image_text ">
           <h5 class="pr-3 pl-3 mb-2 mx-5">hkk</h5>
        </div>
    </a>
  </div>

-->
    <!-- Modal -->
<!-- Button trigger modal -->
<!-- Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{workingStatus}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary">Confirmar</button>
      </div>
    </div>
  </div>
</div>

</section>

{% endblock body%}
{% block extra_scripts %}
<script>
$(document).ready(function(){
  
  var workingStatus = '{{workingStatus}}';
  var textToShowInModal ="default"
  var data = {}
  $('#exampleModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        //var recipient = button.data('whatever') // Extract info from data-* attributes
        
        var modal = $(this)
        modal.find('.modal-title').text(textToShowInModal)
        //modal.find('.modal-body input').val(recipient)
    })
  $("#work-button").click(function() {
      if(workingStatus == "isntWorking"){
          alert("Entras del trabajo")
          data = {
            'state' : 0,
            'interaction_type' : "work" ,              
          }
          workingStatus = "working"
          textToShowInModal = "¿Entrar al trabajo?"
          //sendDataToDb(data);
      }else if(workingStatus == "working"){
          alert("Has salido del trabajo")
          data = {
            'state' : 1,
            'interaction_type' : "work",             
          }
          workingStatus = "isntWorking"
          textToShowInModal = "¿Entrar al trabajo?"
          //sendDataToDb(data);
      }else if(workingStatus == "breaking"){
          alert("No puedes salir del trabajo sin haber salido del descanso")
      }


  });

  $("#break-button").click(function() {

      if(workingStatus == "isntWorking"){
          alert("No puedes entrar al descanso si no estas trabajando")
      }else if(workingStatus == "working"){
          alert("Entras al descanso")
          data = {
            'state' : 0,
            'interaction_type' : "break",              
          }
          workingStatus = "breaking"
          sendDataToDb(data);
      }else if(workingStatus == "breaking"){
          alert("Has salido del descanso")
          data = {
            'state' : 1,
            'interaction_type' : "break",                
          }
          workingStatus = "working"
          sendDataToDb(data);
      }
  });
  function sendDataToDb(data){
    //
      console.log("valor del data-> "+ JSON.stringify((data)))      
     $.ajax({
       url: '/ajax/insert_job_interaction/',
       type: 'POST',
       data: data,
       headers: {'X-CSRFToken': "{{csrf_token}}"},
       success: function (data) {
        alert("data inserted")
         if (data.is_taken) {
           alert("data already exists.");
          }
        },
        error: function(jqxhr) {
            alert(jqxhr.responseText); 
        }    
    });
  }
});
</script>
 <!--
   <script src="{% static 'js/home.js' %}"></script>
--> 
   
{% endblock %}